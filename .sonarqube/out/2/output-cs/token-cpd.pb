‘
[C:\Desenvolvimento\Repos\dotnet-search\src\DotNetSearch.Infra.Data\Context\BaseDbContext.cs
	namespace 	
DotNetSearch
 
. 
Infra 
. 
Data !
.! "
Context" )
{ 
public 

abstract 
class 
BaseDbContext '
:( )
	DbContext* 3
,3 4

IDbContext5 ?
{ 
	protected 
BaseDbContext 
(  
DbContextOptions  0
options1 8
)8 9
:: ;
base< @
(@ A
optionsA H
)H I
{J K
}L M
public

 
async

 
Task

 
<

 
bool

 
>

 
Commit

  &
(

& '
)

' (
{ 	
return 
await 
SaveChangesAsync )
() *
)* +
>, -
$num. /
;/ 0
} 	
} 
} „

cC:\Desenvolvimento\Repos\dotnet-search\src\DotNetSearch.Infra.Data\Context\DotNetSearchDbContext.cs
	namespace 	
DotNetSearch
 
. 
Infra 
. 
Data !
.! "
Context" )
{ 
public 

class !
DotNetSearchDbContext &
:' (
BaseDbContext) 6
{ 
public !
DotNetSearchDbContext $
($ %
DbContextOptions% 5
options6 =
)= >
:? @
baseA E
(E F
optionsF M
)M N
{O P
}Q R
public

 
DbSet

 
<

 
Autor

 
>

 
Autor

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
public 
DbSet 
< 
Livro 
> 
Livro !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DbSet 
< 
	Categoria 
> 
	Categoria  )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
} 
} ‚
XC:\Desenvolvimento\Repos\dotnet-search\src\DotNetSearch.Infra.Data\Context\IDbContext.cs
	namespace 	
DotNetSearch
 
. 
Infra 
. 
Data !
.! "
Context" )
{ 
public 

	interface 

IDbContext 
:  !
IUnitOfWork" -
{ 
DbSet		 
<		 
T		 
>		 
Set		 
<		 
T		 
>		 
(		 
)		 
where		 
T		  !
:		" #
class		$ )
;		) *
}

 
} ‰W
tC:\Desenvolvimento\Repos\dotnet-search\src\DotNetSearch.Infra.Data\Migrations\20211231212404_AutorLivroECategoria.cs
	namespace 	
DotNetSearch
 
. 
Infra 
. 
Data !
.! "

Migrations" ,
{ 
public 

partial 
class  
AutorLivroECategoria -
:. /
	Migration0 9
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 
CreateTable

 (
(

( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
Guid& *
>* +
(+ ,
type, 0
:0 1
$str2 D
,D E
nullableF N
:N O
falseP U
)U V
,V W
Nome 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
nullableG O
:O P
trueQ U
)U V
,V W
DataNascimento "
=# $
table% *
.* +
Column+ 1
<1 2
DateTime2 :
>: ;
(; <
type< @
:@ A
$strB M
,M N
nullableO W
:W X
falseY ^
)^ _
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
x6 7
.7 8
Id8 :
): ;
;; <
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str !
,! "
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
Guid& *
>* +
(+ ,
type, 0
:0 1
$str2 D
,D E
nullableF N
:N O
falseP U
)U V
,V W
Nome 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
nullableG O
:O P
trueQ U
)U V
} 
, 
constraints 
: 
table "
=># %
{ 
table   
.   

PrimaryKey   $
(  $ %
$str  % 3
,  3 4
x  5 6
=>  7 9
x  : ;
.  ; <
Id  < >
)  > ?
;  ? @
}!! 
)!! 
;!! 
migrationBuilder## 
.## 
CreateTable## (
(##( )
name$$ 
:$$ 
$str$$ 
,$$ 
columns%% 
:%% 
table%% 
=>%% !
new%%" %
{&& 
Id'' 
='' 
table'' 
.'' 
Column'' %
<''% &
Guid''& *
>''* +
(''+ ,
type'', 0
:''0 1
$str''2 D
,''D E
nullable''F N
:''N O
false''P U
)''U V
,''V W
Titulo(( 
=(( 
table(( "
.((" #
Column((# )
<(() *
string((* 0
>((0 1
(((1 2
type((2 6
:((6 7
$str((8 G
,((G H
nullable((I Q
:((Q R
true((S W
)((W X
,((X Y
Sinopse)) 
=)) 
table)) #
.))# $
Column))$ *
<))* +
string))+ 1
>))1 2
())2 3
type))3 7
:))7 8
$str))9 H
,))H I
nullable))J R
:))R S
true))T X
)))X Y
,))Y Z
Capa** 
=** 
table**  
.**  !
Column**! '
<**' (
string**( .
>**. /
(**/ 0
type**0 4
:**4 5
$str**6 E
,**E F
nullable**G O
:**O P
true**Q U
)**U V
,**V W
NumeroPaginas++ !
=++" #
table++$ )
.++) *
Column++* 0
<++0 1
int++1 4
>++4 5
(++5 6
type++6 :
:++: ;
$str++< A
,++A B
nullable++C K
:++K L
false++M R
)++R S
,++S T
DataPublicacao,, "
=,,# $
table,,% *
.,,* +
Column,,+ 1
<,,1 2
DateTime,,2 :
>,,: ;
(,,; <
type,,< @
:,,@ A
$str,,B M
,,,M N
nullable,,O W
:,,W X
false,,Y ^
),,^ _
,,,_ `
AutorId-- 
=-- 
table-- #
.--# $
Column--$ *
<--* +
Guid--+ /
>--/ 0
(--0 1
type--1 5
:--5 6
$str--7 I
,--I J
nullable--K S
:--S T
false--U Z
)--Z [
}.. 
,.. 
constraints// 
:// 
table// "
=>//# %
{00 
table11 
.11 

PrimaryKey11 $
(11$ %
$str11% /
,11/ 0
x111 2
=>113 5
x116 7
.117 8
Id118 :
)11: ;
;11; <
table22 
.22 

ForeignKey22 $
(22$ %
name33 
:33 
$str33 6
,336 7
column44 
:44 
x44  !
=>44" $
x44% &
.44& '
AutorId44' .
,44. /
principalTable55 &
:55& '
$str55( /
,55/ 0
principalColumn66 '
:66' (
$str66) -
,66- .
onDelete77  
:77  !
ReferentialAction77" 3
.773 4
Cascade774 ;
)77; <
;77< =
}88 
)88 
;88 
migrationBuilder:: 
.:: 
CreateTable:: (
(::( )
name;; 
:;; 
$str;; '
,;;' (
columns<< 
:<< 
table<< 
=><< !
new<<" %
{== 
Id>> 
=>> 
table>> 
.>> 
Column>> %
<>>% &
Guid>>& *
>>>* +
(>>+ ,
type>>, 0
:>>0 1
$str>>2 D
,>>D E
nullable>>F N
:>>N O
false>>P U
)>>U V
,>>V W
LivroId?? 
=?? 
table?? #
.??# $
Column??$ *
<??* +
Guid??+ /
>??/ 0
(??0 1
type??1 5
:??5 6
$str??7 I
,??I J
nullable??K S
:??S T
false??U Z
)??Z [
,??[ \
CategoriaId@@ 
=@@  !
table@@" '
.@@' (
Column@@( .
<@@. /
Guid@@/ 3
>@@3 4
(@@4 5
type@@5 9
:@@9 :
$str@@; M
,@@M N
nullable@@O W
:@@W X
false@@Y ^
)@@^ _
}AA 
,AA 
constraintsBB 
:BB 
tableBB "
=>BB# %
{CC 
tableDD 
.DD 

PrimaryKeyDD $
(DD$ %
$strDD% 9
,DD9 :
xDD; <
=>DD= ?
xDD@ A
.DDA B
IdDDB D
)DDD E
;DDE F
tableEE 
.EE 

ForeignKeyEE $
(EE$ %
nameFF 
:FF 
$strFF H
,FFH I
columnGG 
:GG 
xGG  !
=>GG" $
xGG% &
.GG& '
CategoriaIdGG' 2
,GG2 3
principalTableHH &
:HH& '
$strHH( 3
,HH3 4
principalColumnII '
:II' (
$strII) -
,II- .
onDeleteJJ  
:JJ  !
ReferentialActionJJ" 3
.JJ3 4
CascadeJJ4 ;
)JJ; <
;JJ< =
tableKK 
.KK 

ForeignKeyKK $
(KK$ %
nameLL 
:LL 
$strLL @
,LL@ A
columnMM 
:MM 
xMM  !
=>MM" $
xMM% &
.MM& '
LivroIdMM' .
,MM. /
principalTableNN &
:NN& '
$strNN( /
,NN/ 0
principalColumnOO '
:OO' (
$strOO) -
,OO- .
onDeletePP  
:PP  !
ReferentialActionPP" 3
.PP3 4
CascadePP4 ;
)PP; <
;PP< =
}QQ 
)QQ 
;QQ 
migrationBuilderSS 
.SS 
CreateIndexSS (
(SS( )
nameTT 
:TT 
$strTT (
,TT( )
tableUU 
:UU 
$strUU 
,UU 
columnVV 
:VV 
$strVV !
)VV! "
;VV" #
migrationBuilderXX 
.XX 
CreateIndexXX (
(XX( )
nameYY 
:YY 
$strYY 6
,YY6 7
tableZZ 
:ZZ 
$strZZ (
,ZZ( )
column[[ 
:[[ 
$str[[ %
)[[% &
;[[& '
migrationBuilder]] 
.]] 
CreateIndex]] (
(]]( )
name^^ 
:^^ 
$str^^ 2
,^^2 3
table__ 
:__ 
$str__ (
,__( )
column`` 
:`` 
$str`` !
)``! "
;``" #
}aa 	
	protectedcc 
overridecc 
voidcc 
Downcc  $
(cc$ %
MigrationBuildercc% 5
migrationBuildercc6 F
)ccF G
{dd 	
migrationBuilderee 
.ee 
	DropTableee &
(ee& '
nameff 
:ff 
$strff '
)ff' (
;ff( )
migrationBuilderhh 
.hh 
	DropTablehh &
(hh& '
nameii 
:ii 
$strii !
)ii! "
;ii" #
migrationBuilderkk 
.kk 
	DropTablekk &
(kk& '
namell 
:ll 
$strll 
)ll 
;ll 
migrationBuildernn 
.nn 
	DropTablenn &
(nn& '
nameoo 
:oo 
$stroo 
)oo 
;oo 
}pp 	
}qq 
}rr ‘
fC:\Desenvolvimento\Repos\dotnet-search\src\DotNetSearch.Infra.Data\Repositories\CategoriaRepository.cs
	namespace 	
DotNetSearch
 
. 
Infra 
. 
Data !
.! "
Repositories" .
{ 
public 

class 
CategoriaRepository $
:% &

Repository' 1
<1 2
	Categoria2 ;
>; <
,< = 
ICategoriaRepository> R
{ 
public		 
CategoriaRepository		 "
(		" #!
DotNetSearchDbContext		# 8
	dbContext		9 B
)		B C
:		D E
base		F J
(		J K
	dbContext		K T
)		T U
{		V W
}		X Y
}

 
} ý&
]C:\Desenvolvimento\Repos\dotnet-search\src\DotNetSearch.Infra.Data\Repositories\Repository.cs
	namespace 	
DotNetSearch
 
. 
Infra 
. 
Data !
.! "
Repositories" .
{ 
public 

abstract 
class 

Repository $
<$ %
TEntity% ,
>, -
:. /
IRepository0 ;
<; <
TEntity< C
>C D
whereE J
TEntityK R
:S T
EntityU [
{ 
private 
readonly 
BaseDbContext &

_dbContext' 1
;1 2
private 
readonly 
DbSet 
< 
TEntity &
>& '
_dbSet( .
;. /
	protected 

Repository 
( 
BaseDbContext *
	dbContext+ 4
)4 5
{ 	

_dbContext 
= 
	dbContext "
;" #
_dbSet 
= 

_dbContext 
.  
Set  #
<# $
TEntity$ +
>+ ,
(, -
)- .
;. /
} 	
public 
IUnitOfWork 

UnitOfWork %
=>& (

_dbContext) 3
;3 4
private 

IQueryable 
< 
TEntity "
>" #
	BaseQuery$ -
(- .
). /
{ 	
return 
_dbSet 
; 
} 	
	protected 
virtual 

IQueryable $
<$ %
TEntity% ,
>, -
ImproveQuery. :
(: ;

IQueryable; E
<E F
TEntityF M
>M N
queryO T
)T U
{   	
return!! 
query!! 
;!! 
}"" 	
public$$ 
virtual$$ 

IQueryable$$ !
<$$! "
TEntity$$" )
>$$) *
Query$$+ 0
($$0 1
)$$1 2
{%% 	
return&& 
ImproveQuery&& 
(&&  
	BaseQuery&&  )
(&&) *
)&&* +
)&&+ ,
;&&, -
}'' 	
public)) 
virtual)) 
async)) 
Task)) !
<))! "
IEnumerable))" -
<))- .
TEntity)). 5
>))5 6
>))6 7
Search))8 >
())> ?

Expression))? I
<))I J
Func))J N
<))N O
TEntity))O V
,))V W
bool))X \
>))\ ]
>))] ^
	predicate))_ h
)))h i
{** 	
return++ 
await++ 
Query++ 
(++ 
)++  
.++  !
Where++! &
(++& '
	predicate++' 0
)++0 1
.++1 2
ToListAsync++2 =
(++= >
)++> ?
;++? @
},, 	
public.. 
virtual.. 
async.. 
Task.. !
<..! "
IEnumerable.." -
<..- .
TEntity... 5
>..5 6
>..6 7
GetAll..8 >
(..> ?
)..? @
{// 	
return00 
await00 
Query00 
(00 
)00  
.00  !
ToListAsync00! ,
(00, -
)00- .
;00. /
}11 	
public33 
virtual33 
async33 
Task33 !
<33! "
TEntity33" )
>33) *
GetById33+ 2
(332 3
Guid333 7
id338 :
)33: ;
{44 	
var55 
teste55 
=55 
Query55 
(55 
)55 
;55  
return66 
await66 
teste66 
.66 
FirstOrDefaultAsync66 2
(662 3
x663 4
=>665 7
x668 9
.669 :
Id66: <
==66= ?
id66@ B
)66B C
;66C D
}77 	
public99 
virtual99 
void99 
Add99 
(99  
TEntity99  '
entity99( .
)99. /
{:: 	
_dbSet;; 
.;; 
Add;; 
(;; 
entity;; 
);; 
;;; 
}<< 	
public>> 
virtual>> 
void>> 
Update>> "
(>>" #
TEntity>># *
entity>>+ 1
)>>1 2
{?? 	
_dbSet@@ 
.@@ 
Update@@ 
(@@ 
entity@@  
)@@  !
;@@! "
}AA 	
publicCC 
virtualCC 
voidCC 
RemoveCC "
(CC" #
TEntityCC# *
entityCC+ 1
)CC1 2
{DD 	
_dbSetEE 
.EE 
RemoveEE 
(EE 
entityEE  
)EE  !
;EE! "
}FF 	
}GG 
}HH 